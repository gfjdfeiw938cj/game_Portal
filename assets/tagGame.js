import"./modulepreload-polyfill.js";const e={pause:!1,matrixRandomCells:[],matrixClassPattern:[],matrixWinning:[],localStorageCouter:0,seconds:0,minutes:0,timerId:``,fontSizeCell:`0px`,clearLocalStorage:!1,currentNumber:1,startSettings(){this.pause=!1,this.matrixRandomCells=[],this.matrixClassPattern=[],this.matrixWinning=[],this.localStorageCouter=0,this.seconds=0,this.minutes=0,this.timerId=``,this.fontSizeCell=`0px`,this.clearLocalStorage=!1,this.currentNumber=1},restoreInitialSettings(e,t,n,r){this.pause=!1,this.matrixRandomCells=[],this.matrixClassPattern=t,this.matrixWinning=e,this.localStorageCouter=0,this.seconds=0,this.minutes=0,this.timerId=n,this.fontSizeCell=r,this.clearLocalStorage=!1,this.currentNumber=1},writeStorageSettings(e){this.pause=e.pause,this.matrixRandomCells=e.matrixRandomCells,this.matrixClassPattern=e.matrixClassPattern,this.matrixWinning=e.matrixWinning,this.localStorageCouter=e.localStorageCouter,this.seconds=e.seconds,this.minutes=e.minutes,this.timerId=e.timerId,this.fontSizeCell=e.fontSizeCell,this.clearLocalStorage=e.clearLocalStorage,this.currentNumber=e.currentNumber}};document.querySelectorAll(`.arrow-diag`).forEach(t=>{t.addEventListener(`click`,function(t){t.stopPropagation();let r=JSON.parse(localStorage.getItem(`map`))||[];t.target.classList[1]===`left`?e.localStorageCouter>0&&(--e.localStorageCouter,e.couterGame=e.localStorageCouter,_(),h(e.matrixRandomCells=n(!1,!0),e.couterGame)):e.localStorageCouter<r.length-1&&(e.localStorageCouter+=1,e.couterGame=e.localStorageCouter,_(),h(e.matrixRandomCells=n(!1,!0),e.couterGame))})});function t(){let t=JSON.parse(localStorage.getItem(`map`))||[];if(t.length===0){localStorage.setItem(`map`,JSON.stringify([e.matrixRandomCells])),e.localStorageCouter=0,e.couterGame=0,r();return}if(e.clearLocalStorage){let n=t.slice(0,e.localStorageCouter+1);n.push(e.matrixRandomCells),localStorage.setItem(`map`,JSON.stringify(n)),e.localStorageCouter=n.length-1,e.couterGame=e.localStorageCouter,e.clearLocalStorage=!1,r();return}t.push(e.matrixRandomCells),localStorage.setItem(`map`,JSON.stringify(t)),e.localStorageCouter=t.length-1,e.couterGame=e.localStorageCouter,r()}function n(t,n){let r=JSON.parse(localStorage.getItem(`map`))||[];return e.clearLocalStorage=!0,t?r[0]||null:n?r[e.localStorageCouter]||null:r[r.length-1]||null}function r(){localStorage.setItem(`objDateLastMove`,JSON.stringify(e))}function i(){let e=JSON.parse(localStorage.getItem(`map`))||[];return{gameSettingsStorage:JSON.parse(localStorage.getItem(`objDateLastMove`))||{},map:e[e.length-1]||null}}function a(e,t,n,r,i){let a=JSON.parse(localStorage.getItem(`objVictoryGame`))||[],o={GameSettings:JSON.parse(localStorage.getItem(`map`))||[],time:`${t[1]}:${t[0]}`,couterMove:e,matrixWinning:n,matrixClassPattern:r,date:i};if(a.length===0){localStorage.setItem(`objVictoryGame`,JSON.stringify([o]));return}a.push(o),localStorage.setItem(`objVictoryGame`,JSON.stringify(a))}function o(){return JSON.parse(localStorage.getItem(`objVictoryGame`))||[]}var s=document.querySelector(`.container-blink-none`),c=document.querySelector(`.blink-playingGame`),l=[];async function u(t,n=0,r=1e3){let i=o();if(!i||!i[t]){console.error(`Запись не найдена:`,t);return}e.matrixWinning=i[t].matrixWinning,e.matrixClassPattern=i[t].matrixClassPattern,s.classList.add(`container-blink-block`);let a=i[t].GameSettings;for(let i=n;i<a.length;i++){if(e.pause){c.textContent=`Пауза`,g(t,i);return}c.textContent=`Идёт воспроизведение записи игры!`,_(),g(t,i),h(a[i],i),await new Promise(e=>{let t=setTimeout(()=>{e()},r);l.push(t)}),d()}window.location.href=`./recordGame`}function d(){console.log(l),l.forEach(e=>clearTimeout(e)),l=[]}var f=document.querySelector(`.container`),p=document.querySelector(`.couter-Game`),m=document.querySelector(`.panel`);f.addEventListener(`click`,function(n){n.stopPropagation(),!e.pause&&(n.target.innerHTML===``||L(n.target.dataset)||(t(),_(),h(e.matrixRandomCells,e.couterGame)))});function h(t,n){f.style.gridTemplateAreas=e.matrixClassPattern,t.forEach((t,n)=>{t.forEach((t,r)=>{let i=document.createElement(`div`);[[`data-x`,`${r}`],[`data-y`,`${n}`],[`class`,`${t===``?`blackEmptyCage`:`box-${n}`}`],[`data-emptyСell`,`${t!==e.matrixWinning[n][r]}`]].forEach(e=>i.setAttribute(e[0],e[1])),i.innerHTML=t,f.append(i)})});let r=document.querySelectorAll(`.box-0`)[0];e.fontSizeCell===`0px`&&(e.fontSizeCell=`${Math.floor(r.clientWidth*.5)}px`),f.style.fontSize=e.fontSizeCell,p.innerHTML=`Xодов: ${n}`}function g(t,n){m.innerHTML=``,[[`Остановить воспроизведение`,`btn-stop-recording`,function(){let e=window.location.pathname,t=e.substring(0,e.lastIndexOf(`/`)+1);window.location.href=t+`recordGame.html`}],[`Приостановить воспроизведение`,`btn-pause-recording`,function(){e.pause,e.pause=!e.pause,u(t,n)}]].forEach(e=>{let t=document.createElement(`button`);t.className=e[1],t.addEventListener(`click`,e[2]),t.textContent=e[0],m.appendChild(t)})}function _(){f.innerHTML=``}var v=document.getElementById(`display`);function y(){let t=e.seconds.toString().padStart(2,`0`),n=e.minutes.toString().padStart(2,`0`);return v.textContent=`Время: ${n}:${t}`,[t,n]}function b(){e.pause||(e.seconds++,e.seconds>=60&&(e.seconds=0,e.minutes++),y())}var x=document.querySelector(`.hidden`),S=x.children[0],C=document.querySelector(`#reset-New`),w=document.querySelector(`#reset-New-Map`),T=document.querySelector(`.icon-Menu`),E=document.querySelector(`.div-container`),D=document.querySelector(`.menu-container`);w.addEventListener(`click`,function(e){e.stopPropagation(),O(!1,!1)}),C.addEventListener(`click`,function(e){e.stopPropagation(),O(!1,!0)}),T.addEventListener(`click`,function(e){e.stopPropagation(),j(!0)});function O(t,r){if(document.getElementById(`display`).textContent=`Время: 00:00`,e.seconds=0,e.minutes=0,_(),t&&x.classList.add(`hidden`),r){let{gameSettingsStorage:t}=i();e.restoreInitialSettings(t.matrixWinning,t.matrixClassPattern,t.timerId,t.fontSizeCell),e.matrixRandomCells=n(!0,!1),h(e.matrixRandomCells,0),j(!1)}else{clearTimeout(e.timerId),e.fontSizeCell=`0px`,j(!0),M();let t=window.location.pathname,n=t.substring(0,t.lastIndexOf(`/`)+1);window.location.href=n+`tagGame.html`}}function k(){let t=new Date,n=S.children[0],r=S.children[1],i=y();a(e.localStorageCouter,i,e.matrixWinning,e.matrixClassPattern,t.toLocaleString(`ru-RU`)),n.innerHTML=`<h2>Победа!</h2>
                            <div class="modal-content">
                            <div>Всего ходов: <strong>${e.localStorageCouter}</strong></div>
                            <div>За время: <strong>${i[1]}:${i[0]}</strong></div>`,r.innerHTML=`<button class="reset-Victory">Играть еще</button>`,r.children[0].addEventListener(`click`,function(e){e.stopPropagation(),O(!0,!1,`icon-hidden`)}),x.classList.remove(`hidden`),j(!1)}function A(){let t=S.children[0],n=S.children[1];x.classList.remove(`hidden`),t.innerHTML=`
    <h2 class="modal-title">Вы не закончили игру</h2>
    <p class="modal-text">Хотите начать заново или продолжить?</p>
  `,n.innerHTML=`
    <button id="сontinue-Game" class="reset">Продолжить</button>
    <button id="start-Game" class="reset">Назад в меню</button>
  `,Array.from(n.children).forEach(t=>{t.addEventListener(`click`,function(t){if(t.stopPropagation(),t.target.id===`сontinue-Game`){let{map:t,gameSettingsStorage:n}=i();e.writeStorageSettings(n),e.timerId=setInterval(b,1e3),x.classList.add(`hidden`),M(),_(),h(t,n.localStorageCouter)}else{e.startSettings(),j(!0);let t=window.location.pathname.replace(/\/[^/]+\/[^/]+$/,``)+`/mainMenu.html`;window.location.href=t}})})}function j(e){e&&localStorage.removeItem(`map`),localStorage.removeItem(`objDateLastMove`)}function M(){D.classList.toggle(`menu-hidden`),E.classList.toggle(`div-container-visible`),T.classList.toggle(`icon-hidden`)}function N(e,t,n,r){let i;function a(e){if(e.length<=1)return 0;let t=Math.floor(e.length/2),n=e.slice(0,t),r=e.slice(t),o=a(n)+a(r),s=0,c=0,l=0;for(;s<n.length&&c<r.length;)n[s]<=r[c]?e[l++]=n[s++]:(e[l++]=r[c++],!i&&r.length>1&&n.length>1&&(i=[r[0],n[1]]),o+=n.length-s);for(;s<n.length;)e[l++]=n[s++];for(;c<r.length;)e[l++]=r[c++];return o}let o=a(e.slice());if(r%2==1)return o%2==0?(e.splice(t,0,``),e):(e[e.indexOf(i[1])]=i[0],e[e.lastIndexOf(i[0])]=i[1],e.splice(t,0,``),e);{let i=n-Math.floor(t/r),a=o%2==0,s=i%2==1;return a===s?(e.splice(t,0,``),e):s===!1?(e.length-i===0?e.splice(t+r,0,``):e.splice(t-r,0,``),e):(i===1&&e.splice(t-r,0,``),e.splice(t+r,0,``),e)}}function P(t,n,r,i){e.currentNumber=0;let a=new Set;for(;a.size<t-1;){let e=Math.floor(Math.random()*(t-1))+1;a.add(e)}a=Array.from(a);let o=N(a,n,r,i);return Array.from({length:r},()=>Array.from({length:i},()=>o[e.currentNumber++]))}function F(n,r){e.timerId&&clearTimeout(e.timerId),e.matrixRandomCells=I(n,r),t(),e.timerId=setInterval(b,1e3),h(e.matrixRandomCells,0)}function I(t,n){let r=t*n,i=Math.floor(Math.random()*r);return e.currentNumber=1,e.matrixWinning=Array.from({length:t},()=>Array.from({length:n},()=>e.currentNumber===r?``:e.currentNumber++)),e.matrixRandomCells=P(r,i,t,n),e.matrixClassPattern=e.matrixWinning.map(e=>`"${e.map(e=>e=`A`).join(` `)}"`).join(``),e.matrixRandomCells}function L({x:t,y:n}){t=Number(t),n=Number(n);let r=e.matrixRandomCells[n],i=e.matrixRandomCells.map(e=>e[t]),a;if(r.includes(``)){let i=r.indexOf(``);return a=i>t?r.copyWithin(i-(i-t-1),t,i).toSpliced(t,1,``):r.copyWithin(i,i+1,t+1).toSpliced(t,1,``),e.matrixRandomCells[n]=a,R(),!1}else if(i.includes(``)){let r=i.indexOf(``);return a=r>n?i.copyWithin(r-(r-n-1),n,r).toSpliced(n,1,``):i.copyWithin(r,r+1,n+1).toSpliced(n,1,``),e.matrixRandomCells.forEach((e,n)=>e[t]=a[n]),R(),!1}else return!0}function R(){e.matrixRandomCells.toString()===e.matrixWinning.toString()&&(clearTimeout(e.timerId),k())}var z=document.querySelector(`.menu-container`),B=document.querySelector(`.custom-map-btm`),V=document.querySelector(`.level-menu`),H=document.querySelectorAll(`.level-btn`);if(window.performance){let e=new URLSearchParams(window.location.search).get(`indMap`);e&&(M(),localStorage.removeItem(`objDateLastMove`),u(e)),localStorage.getItem(`objDateLastMove`)!==null&&A()}H.forEach(e=>{e.addEventListener(`click`,t=>{t.stopPropagation();let n=e.textContent.match(/Карта (\d+)x(\d+)/);n&&W(parseInt(n[1],10),parseInt(n[2],10))})}),B.addEventListener(`click`,()=>{let e=document.querySelector(`.game-title`);e.textContent=`Свой размер карты`;let t=document.createElement(`div`);t.className=`form-container`;let n=document.createElement(`form`);n.id=`myForm`,n.setAttribute(`aria-labelledby`,`customSizeLabel`);let r=document.createElement(`div`);r.className=`input-group`;let i=document.createElement(`label`);i.htmlFor=`length-Matrix`,i.textContent=`Длина (строк):`;let a=document.createElement(`input`);a.className=`panel-Matrix`,a.id=`length-Matrix`,a.name=`sizeMatrix`,a.type=`number`,a.min=`2`,a.max=`10`,a.placeholder=`от 3 до 10`,a.required=!0,r.append(i,a);let o=document.createElement(`div`);o.className=`input-group`;let s=document.createElement(`label`);s.htmlFor=`width-Matrix`,s.textContent=`Ширина (столбцов):`;let c=document.createElement(`input`);c.className=`panel-Matrix`,c.id=`width-Matrix`,c.name=`sizeMatrix`,c.type=`number`,c.min=`2`,c.max=`10`,c.placeholder=`от 3 до 10`,c.required=!0,o.append(s,c);let l=document.createElement(`div`);l.className=`button-group`;let u=document.createElement(`button`);u.type=`submit`,u.className=`buttonSubmit`,u.id=`Sab`,u.textContent=`Играть`;let d=document.createElement(`button`);d.type=`button`,d.className=`level-btn`,d.textContent=`назад в меню`,d.addEventListener(`click`,()=>{let e=window.location.pathname,t=e.substring(0,e.lastIndexOf(`/`)+1);window.location.href=t+`tagGame.html`},{once:!0}),l.append(u,d),n.append(r,o,l),t.append(n),V.innerHTML=``,V.append(t),n.addEventListener(`submit`,async e=>{e.preventDefault();let[t,n]=await U(e.target);W(t,n)})});async function U(e){return new FormData(e).getAll(`sizeMatrix`).map(e=>Number(e))}function W(e,t){z.addEventListener(`transitionend`,n=>{n.stopPropagation(),M(),F(e,t)},{once:!0})}var G=document.querySelector(`.pause-btn`),K=document.querySelectorAll(`.reset`);G.addEventListener(`click`,function(t){t.stopPropagation(),e.pause=!e.pause,e.pause?(G.classList.add(`pause-btn-colorRed`),G.innerHTML=`&#9654`,e.pause=!0,K.forEach(e=>{e.disabled=!0})):(G.classList.remove(`pause-btn-colorRed`),G.innerHTML=`&#10074;&#10074;`,e.pause=!1,K.forEach(e=>{e.disabled=!1}))});